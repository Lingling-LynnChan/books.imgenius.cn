{% extends 'base.html' %}

{% block title %}管理员后台 - 阅读创作网站{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="fas fa-shield-alt"></i> 管理员后台
                </h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- 待审核作品统计 -->
                    <div class="col-md-6 mb-4">
                        <div class="card border-warning">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0">
                                    <i class="fas fa-book"></i> 待审核作品
                                </h5>
                            </div>
                            <div class="card-body">
                                <p class="card-text">
                                    <span class="badge bg-warning text-dark fs-6">{{ pending_books|length }}</span>
                                    个作品等待审核
                                </p>
                                {% if pending_books %}
                                    <div class="list-group">
                                        {% for book in pending_books|slice:":5" %}
                                            <div class="list-group-item">
                                                <h6 class="mb-1">{{ book.title|default:book.title_pending }}</h6>
                                                <p class="mb-1 text-muted small">
                                                    作者: {{ book.author.display_name }}
                                                </p>
                                                <small class="text-muted">
                                                    {{ book.updated_at|date:"Y-m-d H:i" }}
                                                </small>
                                                <div class="mt-2">
                                                    <a href="{% url 'books:admin_review' book.id %}" 
                                                       class="btn btn-sm btn-outline-primary">
                                                        <i class="fas fa-eye"></i> 审核
                                                    </a>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    {% if pending_books|length > 5 %}
                                        <div class="mt-3 text-center">
                                            <small class="text-muted">还有 {{ pending_books|length|add:"-5" }} 个作品...</small>
                                        </div>
                                    {% endif %}
                                {% else %}
                                    <p class="text-muted">暂无待审核作品</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- 待审核章节统计 -->
                    <div class="col-md-6 mb-4">
                        <div class="card border-info">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0">
                                    <i class="fas fa-file-alt"></i> 待审核章节
                                </h5>
                            </div>
                            <div class="card-body">
                                <p class="card-text">
                                    <span class="badge bg-info fs-6">{{ pending_chapters|length }}</span>
                                    个章节等待审核
                                </p>
                                {% if pending_chapters %}
                                    <div class="list-group">
                                        {% for chapter in pending_chapters|slice:":5" %}
                                            <div class="list-group-item">
                                                <h6 class="mb-1">{{ chapter.title|default:chapter.title_pending }}</h6>
                                                <p class="mb-1 text-muted small">
                                                    章节 {{ chapter.chapter_number }}
                                                </p>
                                                <small class="text-muted">
                                                    {{ chapter.updated_at|date:"Y-m-d H:i" }}
                                                </small>
                                                <div class="mt-2">
                                                    <a href="{% url 'books:admin_chapter_review' chapter.book_id %}?chapter={{ chapter.chapter_number }}" 
                                                       class="btn btn-sm btn-outline-info">
                                                        <i class="fas fa-eye"></i> 审核
                                                    </a>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    {% if pending_chapters|length > 5 %}
                                        <div class="mt-3 text-center">
                                            <small class="text-muted">还有 {{ pending_chapters|length|add:"-5" }} 个章节...</small>
                                        </div>
                                    {% endif %}
                                {% else %}
                                    <p class="text-muted">暂无待审核章节</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 快速操作 -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-tools"></i> 快速操作
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3 mb-3">
                                        <a href="{% url 'books:read' %}" class="btn btn-outline-primary w-100">
                                            <i class="fas fa-list"></i><br>
                                            浏览作品
                                        </a>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <a href="{% url 'books:create' %}" class="btn btn-outline-info w-100">
                                            <i class="fas fa-plus"></i><br>
                                            创作中心
                                        </a>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <button class="btn btn-outline-warning w-100" onclick="refreshData()">
                                            <i class="fas fa-sync-alt"></i><br>
                                            刷新数据
                                        </button>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <a href="{% url 'accounts:profile' %}" class="btn btn-outline-success w-100">
                                            <i class="fas fa-user-cog"></i><br>
                                            个人设置
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 系统统计 -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-chart-bar"></i> 系统统计
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-md-3">
                                        <div class="border-end">
                                            <h4 class="text-primary">{{ total_users }}</h4>
                                            <p class="text-muted">总用户数</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="border-end">
                                            <h4 class="text-success">{{ total_books }}</h4>
                                            <p class="text-muted">总作品数</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="border-end">
                                            <h4 class="text-info">{{ total_chapters }}</h4>
                                            <p class="text-muted">总章节数</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <h4 class="text-warning">{{ total_comments }}</h4>
                                        <p class="text-muted">总评论数</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // 自动刷新页面数据
    setInterval(function() {
        refreshData();
    }, 60000); // 60秒刷新一次
});

function refreshData() {
    const $refreshBtn = $('button:contains("刷新数据")');
    const originalHtml = $refreshBtn.html();
    
    // 显示加载状态
    $refreshBtn.html('<i class="fas fa-spinner fa-spin"></i><br>刷新中...');
    $refreshBtn.prop('disabled', true);
    
    // 刷新页面
    setTimeout(function() {
        window.location.reload();
    }, 1000);
}

// 添加一些交互效果
$('.card').hover(
    function() {
        $(this).addClass('shadow-lg');
    },
    function() {
        $(this).removeClass('shadow-lg');
    }
);
</script>
{% endblock %}
